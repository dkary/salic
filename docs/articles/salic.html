<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to salic • salic</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to salic">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">salic</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/salic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/southwick-associates/salic">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to salic</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/southwick-associates/salic/blob/master/vignettes/salic.Rmd"><code>vignettes/salic.Rmd</code></a></small>
      <div class="hidden name"><code>salic.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Salic provides a set of functions to progress from state license data to dashboard summaries. The workflow uses package dplyr (see the <a href="https://dplyr.tidyverse.org/">dplyr website</a> for an introduction). You’ll want to load both packages when using salic:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(salic)
<span class="kw">library</span>(dplyr)</code></pre></div>
<p>This vignette walks through salic functionality using provided sample data. A function reference can be accessed from <code><a href="../reference/salic.html">?salic</a></code>; it’s organization mirrors this vignette.</p>
</div>
<div id="standardized-license-data" class="section level2">
<h2 class="hasAnchor">
<a href="#standardized-license-data" class="anchor"></a>Standardized License Data</h2>
<p>To facilitate a generalized workflow salic is strict about data formatting, and up-front effort is necessary to standardize the relevant state-level data. That said, the data needs are fairly light: Only 9 variables are needed, and all personally identifiable information can be excluded.</p>
<p>Salic specifies each table’s formatting expectations (see <code><a href="../reference/cust.html">?cust</a></code>, <code><a href="../reference/sale.html">?sale</a></code>, and <code><a href="../reference/lic.html">?lic</a></code>). The 3 tables should be related by 2 key columns (cust_id, lic_id):</p>
<p><br><img src="relations.png"></p>
<p><br><em>Note that although residency (res) is a customer-level variable, it can change over time; hence the recommended sale-level specification.</em></p>
<div id="primary-keys" class="section level3">
<h3 class="hasAnchor">
<a href="#primary-keys" class="anchor"></a>Primary Keys</h3>
<p>The <code>cust$cust_id</code> and <code>lic$lic_id</code> variables represent primary key columns (i.e., they must uniquely identify rows in the table):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load sample data</span>
<span class="kw">data</span>(cust, lic, sale) 

<span class="co"># check customer ID</span>
<span class="kw">length</span>(<span class="kw">unique</span>(cust<span class="op">$</span>cust_id)) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(cust)
<span class="co">#&gt; [1] TRUE</span>

<span class="co"># check license ID</span>
<span class="kw">length</span>(<span class="kw">unique</span>(lic<span class="op">$</span>lic_id)) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(lic)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div id="checking-formatting-rules" class="section level3">
<h3 class="hasAnchor">
<a href="#checking-formatting-rules" class="anchor"></a>Checking Formatting Rules</h3>
<p>Salic helps you follow its formatting rules with <code><a href="../reference/data_check.html">data_check()</a></code>. The function call is silent if all checks pass; warnings will be printed for every failed check.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># prints no warnings</span>
<span class="kw"><a href="../reference/data_check.html">data_check</a></span>(cust, lic, sale) 

<span class="co"># introduce rule-breaking changes</span>
cust_tmp &lt;-<span class="st"> </span>cust
cust_tmp<span class="op">$</span>birth_year &lt;-<span class="st"> </span><span class="ot">NULL</span>
cust_tmp<span class="op">$</span>sex[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">3</span>
<span class="kw"><a href="../reference/data_check.html">data_check</a></span>(cust_tmp, lic, sale)
<span class="co">#&gt; Warning: cust: 1 Missing variable(s): birth_year</span>
<span class="co">#&gt; Warning: cust$sex: Contains values that aren't allowed: 3</span></code></pre></div>
</div>
<div id="categorical-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#categorical-variables" class="anchor"></a>Categorical Variables</h3>
<p>Salic expects specific numeric codes for categorical variables. For example, “sex” must be 1 of 3 values for every customer (1=Male, 2=Female, NA=Unknown):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(cust, sex)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;     sex     n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1 21965</span>
<span class="co">#&gt; 2     2  7498</span>
<span class="co">#&gt; 3    NA   537</span></code></pre></div>
</div>
<div id="sales-year-month" class="section level3">
<h3 class="hasAnchor">
<a href="#sales-year-month" class="anchor"></a>Sales: year &amp; month</h3>
<p>The “year” and “month” variables indicate the date of purchase (1 = Jan, 2 = Feb, etc.).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sales by month in 2016</span>
<span class="kw">filter</span>(sale, year <span class="op">==</span><span class="st"> </span><span class="dv">2016</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(year, month)
<span class="co">#&gt; # A tibble: 12 x 3</span>
<span class="co">#&gt;     year month     n</span>
<span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2016     1   205</span>
<span class="co">#&gt;  2  2016     2   289</span>
<span class="co">#&gt;  3  2016     3   943</span>
<span class="co">#&gt;  4  2016     4   904</span>
<span class="co">#&gt;  5  2016     5   799</span>
<span class="co">#&gt;  6  2016     6  1057</span>
<span class="co">#&gt;  7  2016     7  1867</span>
<span class="co">#&gt;  8  2016     8  2205</span>
<span class="co">#&gt;  9  2016     9  2686</span>
<span class="co">#&gt; 10  2016    10  1392</span>
<span class="co">#&gt; 11  2016    11  1180</span>
<span class="co">#&gt; 12  2016    12   539</span></code></pre></div>
<p>The month variable is needed for building “mid-year” dashboards, which present a year-to-year view for the first six months of sales.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># count of customers (by year) who purchased in the first 6 months</span>
<span class="kw">filter</span>(sale, year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2015</span>, month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">6</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">distinct</span>(cust_id, year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(year)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;    year     n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  2016  3461</span>
<span class="co">#&gt; 2  2017  3490</span>
<span class="co">#&gt; 3  2018  3220</span></code></pre></div>
</div>
<div id="licenses-type" class="section level3">
<h3 class="hasAnchor">
<a href="#licenses-type" class="anchor"></a>Licenses: type</h3>
<p>The license table includes two columns important for customer trending. The “type” column specifies whether a license provides:</p>
<ul>
<li>a hunting privilege: “hunt”</li>
<li>a fishing privilege: “fish”</li>
<li>or both: “combo”</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(lic, type)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   type      n</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 combo    18</span>
<span class="co">#&gt; 2 fish     36</span>
<span class="co">#&gt; 3 hunt     82</span>

<span class="co"># count hunters for select years</span>
<span class="kw">filter</span>(lic, type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"hunt"</span>, <span class="st">"combo"</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(sale, <span class="dt">by =</span> <span class="st">"lic_id"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2015</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">distinct</span>(cust_id, year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(year)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;    year     n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  2016  2868</span>
<span class="co">#&gt; 2  2017  3008</span>
<span class="co">#&gt; 3  2018  2925</span></code></pre></div>
</div>
<div id="licenses-duration" class="section level3">
<h3 class="hasAnchor">
<a href="#licenses-duration" class="anchor"></a>Licenses: duration</h3>
<p>The “duration” column is necessary for building a license history. License types can be organized into 3 groups with respect to this variable:</p>
<ul>
<li>Multi-years: duration &gt; 1 (2 = 2-year, 3 = 3-year, etc.)</li>
<li>Lifetimes: duration = 99</li>
<li>All others: duration = 1</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(lic, duration)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   duration     n</span>
<span class="co">#&gt;      &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1        1   102</span>
<span class="co">#&gt; 2        3    20</span>
<span class="co">#&gt; 3       99    14</span>

<span class="co"># customers who buy 3-year licenses</span>
cust_3yr &lt;-<span class="st"> </span><span class="kw">filter</span>(lic, duration <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(sale, <span class="dt">by =</span> <span class="st">"lic_id"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2015</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">distinct</span>(cust_id, year)
<span class="kw">count</span>(cust_3yr, year)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;    year     n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  2016   351</span>
<span class="co">#&gt; 2  2017   360</span>
<span class="co">#&gt; 3  2018   371</span></code></pre></div>
</div>
</div>
<div id="license-history" class="section level2">
<h2 class="hasAnchor">
<a href="#license-history" class="anchor"></a>License History</h2>
<p>The presence of multi-year buyers means that an extra step is needed to produce customer trends. This is accomplished in salic by calling <code><a href="../reference/rank_sale.html">rank_sale()</a></code> &amp; <code><a href="../reference/make_history.html">make_history()</a></code> in sequence.</p>
<div id="ranking-sales" class="section level3">
<h3 class="hasAnchor">
<a href="#ranking-sales" class="anchor"></a>Ranking Sales</h3>
<p>The <code><a href="../reference/rank_sale.html">rank_sale()</a></code> function is used as a preliminary step to reduce the sale table to 1 row per customer-year. It picks the row with the maximum duration value &amp; optionally includes the earliest month value (for mid-year dashboards).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># all hunting (non-combo) sales in 2016</span>
sale_<span class="dv">2016</span> &lt;-<span class="st"> </span><span class="kw">inner_join</span>(
    <span class="kw">filter</span>(sale, year <span class="op">==</span><span class="st"> </span><span class="dv">2016</span>),
    <span class="kw">filter</span>(lic, type <span class="op">==</span><span class="st"> "hunt"</span>),
    <span class="dt">by =</span> <span class="st">"lic_id"</span>
)
<span class="kw">count</span>(sale_<span class="dv">2016</span>, duration, year)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   duration  year     n</span>
<span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1        1  2016  5786</span>
<span class="co">#&gt; 2        3  2016    19</span>
<span class="co">#&gt; 3       99  2016     4</span>

<span class="co"># ranked hunting (non-combo) sales in 2016</span>
<span class="kw"><a href="../reference/rank_sale.html">rank_sale</a></span>(sale_<span class="dv">2016</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(duration, year)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   duration  year     n</span>
<span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1        1  2016  2392</span>
<span class="co">#&gt; 2        3  2016    10</span>
<span class="co">#&gt; 3       99  2016     4</span></code></pre></div>
</div>
<div id="making-license-history" class="section level3">
<h3 class="hasAnchor">
<a href="#making-license-history" class="anchor"></a>Making License History</h3>
<p>The <code><a href="../reference/make_history.html">make_history()</a></code> function creates a larger table with 1 row for every year a license is held (i.e., both purchase years and “carried-over” license years are included).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># rank all sales</span>
sale_ranked &lt;-<span class="st"> </span><span class="kw">inner_join</span>(sale, lic, <span class="dt">by =</span> <span class="st">"lic_id"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/rank_sale.html">rank_sale</a></span>()

<span class="co"># count customers who purchased licenses</span>
<span class="kw">filter</span>(sale_ranked, year <span class="op">%in%</span><span class="st"> </span><span class="dv">2008</span><span class="op">:</span><span class="dv">2010</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(year)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;    year     n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  2008  6393</span>
<span class="co">#&gt; 2  2009  7428</span>
<span class="co">#&gt; 3  2010  7475</span>

<span class="co"># count customers who held licenses</span>
<span class="kw"><a href="../reference/make_history.html">make_history</a></span>(sale_ranked, <span class="dv">2008</span><span class="op">:</span><span class="dv">2018</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="dv">2008</span><span class="op">:</span><span class="dv">2010</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(year)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;    year     n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  2008  6393</span>
<span class="co">#&gt; 2  2009  7591</span>
<span class="co">#&gt; 3  2010  7775</span></code></pre></div>
<p>Certain variables (e.g., sale$res) need to be included in the “carry_vars” argument of <code><a href="../reference/make_history.html">make_history()</a></code> to ensure inclusion in carried-over license years.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># no residency information is included in the output by default</span>
history &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_history.html">make_history</a></span>(sale_ranked, <span class="dv">2008</span><span class="op">:</span><span class="dv">2018</span>)
<span class="kw">names</span>(history)
<span class="co">#&gt; [1] "cust_id"      "year"         "duration_run" "lapse"       </span>
<span class="co">#&gt; [5] "R3"</span>

<span class="co"># include residency</span>
history &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_history.html">make_history</a></span>(sale_ranked, <span class="dv">2008</span><span class="op">:</span><span class="dv">2018</span>, <span class="dt">carry_vars =</span> <span class="st">"res"</span>)
<span class="kw">filter</span>(history, year <span class="op">==</span><span class="st"> </span><span class="dv">2018</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(res)
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;     res     n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     0  2036</span>
<span class="co">#&gt; 2     1  7170</span></code></pre></div>
</div>
<div id="lapse" class="section level3">
<h3 class="hasAnchor">
<a href="#lapse" class="anchor"></a>Lapse</h3>
<p>A license history table makes it easier to look ahead (e.g., who lapsed?) or behind (e.g., who is a recruit?) at the customer level. The <code><a href="../reference/make_history.html">make_history()</a></code> function appends 2 measures for this purpose. The “lapse” variable indicates whether a customer held a privilege in the following year (1 = lapsed, 0 = renewed):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># build hunting privilege history</span>
hunt &lt;-<span class="st"> </span><span class="kw">filter</span>(lic, type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"hunt"</span>, <span class="st">"combo"</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(sale, <span class="dt">by =</span> <span class="st">"lic_id"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/rank_sale.html">rank_sale</a></span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/make_history.html">make_history</a></span>(<span class="dv">2008</span><span class="op">:</span><span class="dv">2018</span>)
    
<span class="co"># hunters in 2016, what % lapsed in 2017? (i.e., churned)</span>
<span class="kw">filter</span>(hunt, year <span class="op">==</span><span class="st"> </span><span class="dv">2016</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(year, lapse) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;    year lapse     n   pct</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2016     0  3415  81.3</span>
<span class="co">#&gt; 2  2016     1   787  18.7</span></code></pre></div>
</div>
<div id="r3" class="section level3">
<h3 class="hasAnchor">
<a href="#r3" class="anchor"></a>R3</h3>
<p>The R3 measure is used to group license holders based on how recently they bought licenses:</p>
<ul>
<li>Retained (1,2): held a license last year, (1: carried over a license), (2: no carry over)</li>
<li>Reactivated (3): no license last year, but did hold one within past 5 years</li>
<li>Recruited (4): no license held within previous 5 years</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># hunters in 2016, what % are in each R3 group?</span>
<span class="kw">filter</span>(hunt, year <span class="op">==</span><span class="st"> </span><span class="dv">2016</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(R3) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;      R3     n   pct</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1  1552 36.9 </span>
<span class="co">#&gt; 2     2  1737 41.3 </span>
<span class="co">#&gt; 3     3   324  7.71</span>
<span class="co">#&gt; 4     4   589 14.0</span></code></pre></div>
<p>Note that R3 is set to missing for the first 5 years for a consistent definition of recruitment across time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(hunt, year <span class="op">%in%</span><span class="st"> </span><span class="dv">2008</span><span class="op">:</span><span class="dv">2013</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(year, R3)
<span class="co">#&gt; # A tibble: 9 x 3</span>
<span class="co">#&gt;    year    R3     n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  2008    NA  2581</span>
<span class="co">#&gt; 2  2009    NA  3044</span>
<span class="co">#&gt; 3  2010    NA  3234</span>
<span class="co">#&gt; 4  2011    NA  3418</span>
<span class="co">#&gt; 5  2012    NA  3548</span>
<span class="co">#&gt; 6  2013     1   990</span>
<span class="co">#&gt; 7  2013     2  1896</span>
<span class="co">#&gt; 8  2013     3   322</span>
<span class="co">#&gt; 9  2013     4   629</span></code></pre></div>
</div>
</div>
<div id="dashboard-metrics" class="section level2">
<h2 class="hasAnchor">
<a href="#dashboard-metrics" class="anchor"></a>Dashboard Metrics</h2>
<p>The license history table provides a flexible data structure for summarizing customer trends. A set of specific summaries are needed for the AFWA national/regional dashboard; the following functions are included for this purpose.</p>
<div id="preparation" class="section level3">
<h3 class="hasAnchor">
<a href="#preparation" class="anchor"></a>Preparation</h3>
<p>Some initial preparation is needed to produce the summaries. Functions <code><a href="../reference/label_categories.html">label_categories()</a></code> &amp; <code><a href="../reference/recode_agecat.html">recode_agecat()</a></code> are included for this purpose.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(history)

history &lt;-<span class="st"> </span>history <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/label_categories.html">label_categories</a></span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/recode_agecat.html">recode_agecat</a></span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span>agecat <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"0-17"</span>, <span class="st">"65+"</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(cust_id, year, res, sex, agecat, R3, lapse)

<span class="co"># view history for 1 customer</span>
<span class="kw">filter</span>(history, cust_id <span class="op">==</span><span class="st"> </span><span class="dv">6120</span>)
<span class="co">#&gt; # A tibble: 7 x 7</span>
<span class="co">#&gt;   cust_id  year res         sex   agecat R3    lapse</span>
<span class="co">#&gt;     &lt;int&gt; &lt;int&gt; &lt;fct&gt;       &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1    6120  2008 Nonresident Male  45-54  &lt;NA&gt;      0</span>
<span class="co">#&gt; 2    6120  2009 Nonresident Male  45-54  &lt;NA&gt;      1</span>
<span class="co">#&gt; 3    6120  2011 Nonresident Male  45-54  &lt;NA&gt;      0</span>
<span class="co">#&gt; 4    6120  2012 Nonresident Male  45-54  &lt;NA&gt;      0</span>
<span class="co">#&gt; 5    6120  2013 Nonresident Male  45-54  Renew     0</span>
<span class="co">#&gt; 6    6120  2014 Nonresident Male  55-64  Renew     0</span>
<span class="co">#&gt; 7    6120  2015 Nonresident Male  55-64  Renew     1</span></code></pre></div>
</div>
<div id="summarize-participants" class="section level3">
<h3 class="hasAnchor">
<a href="#summarize-participants" class="anchor"></a>Summarize Participants</h3>
<p>The <code><a href="../reference/est_part.html">est_part()</a></code> function produces a simple count of participants by year, either overall or broken out by a segment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># overall</span>
part &lt;-<span class="st"> </span><span class="kw"><a href="../reference/est_part.html">est_part</a></span>(history, <span class="st">"tot"</span>)
<span class="kw">filter</span>(part, year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2015</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   tot    year participants</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 All    2016         7095</span>
<span class="co">#&gt; 2 All    2017         7045</span>
<span class="co">#&gt; 3 All    2018         6701</span>

<span class="co"># by gender</span>
part_sex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/est_part.html">est_part</a></span>(history, <span class="st">"sex"</span>)
<span class="kw">filter</span>(part_sex, year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2015</span>)
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   sex     year participants</span>
<span class="co">#&gt;   &lt;fct&gt;  &lt;int&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 Male    2016         5485</span>
<span class="co">#&gt; 2 Male    2017         5433</span>
<span class="co">#&gt; 3 Male    2018         5183</span>
<span class="co">#&gt; 4 Female  2016         1496</span>
<span class="co">#&gt; 5 Female  2017         1510</span>
<span class="co">#&gt; 6 Female  2018         1412</span></code></pre></div>
<p>Because segments usually contain missing values, the <code><a href="../reference/scaleup_part.html">scaleup_part()</a></code> function is provided to peg segment percentages to total values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/scaleup_part.html">scaleup_part</a></span>(part_sex, part) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2015</span>)
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   sex     year participants</span>
<span class="co">#&gt;   &lt;fct&gt;  &lt;int&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 Male    2016         5575</span>
<span class="co">#&gt; 2 Male    2017         5513</span>
<span class="co">#&gt; 3 Male    2018         5266</span>
<span class="co">#&gt; 4 Female  2016         1520</span>
<span class="co">#&gt; 5 Female  2017         1532</span>
<span class="co">#&gt; 6 Female  2018         1435</span></code></pre></div>
</div>
<div id="summarize-churn" class="section level3">
<h3 class="hasAnchor">
<a href="#summarize-churn" class="anchor"></a>Summarize Churn</h3>
<p>The <code><a href="../reference/est_churn.html">est_churn()</a></code>, function summarizes year-to-year turnover.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(history, year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2015</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/est_churn.html">est_churn</a></span>(<span class="st">"tot"</span>)
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   tot    year churn</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 All    2017 0.481</span>
<span class="co">#&gt; 2 All    2018 0.488</span></code></pre></div>
</div>
<div id="automating-with-apply" class="section level3">
<h3 class="hasAnchor">
<a href="#automating-with-apply" class="anchor"></a>Automating with apply</h3>
<p>All of the dashboard summary functions are designed with R’s apply looping functionality in mind:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">segments &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"tot"</span>, <span class="st">"res"</span>, <span class="st">"sex"</span>, <span class="st">"agecat"</span>)

<span class="co"># store participant counts in a list of length 4 (1 per segment)</span>
part &lt;-<span class="st"> </span><span class="kw">sapply</span>(
    segments, 
    <span class="cf">function</span>(i) <span class="kw"><a href="../reference/est_part.html">est_part</a></span>(history, i, <span class="dt">test_threshold =</span> <span class="dv">45</span>), 
    <span class="dt">simplify =</span> <span class="ot">FALSE</span>
)

<span class="co"># print the first 2 rows of each segment table</span>
<span class="cf">for</span> (i <span class="cf">in</span> segments) {
    <span class="kw">head</span>(part[[i]], <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()
    <span class="kw">cat</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)
}
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   tot    year participants</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 All    2008         5834</span>
<span class="co">#&gt; 2 All    2009         6775</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   res       year participants</span>
<span class="co">#&gt;   &lt;fct&gt;    &lt;int&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 Resident  2008         4768</span>
<span class="co">#&gt; 2 Resident  2009         5264</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   sex    year participants</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;int&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 Male   2008         4647</span>
<span class="co">#&gt; 2 Male   2009         5391</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   agecat  year participants</span>
<span class="co">#&gt;   &lt;fct&gt;  &lt;int&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 18-24   2008          709</span>
<span class="co">#&gt; 2 18-24   2009          827</span></code></pre></div>
</div>
<div id="formatting-the-summary-output" class="section level3">
<h3 class="hasAnchor">
<a href="#formatting-the-summary-output" class="anchor"></a>Formatting the Summary Output</h3>
<p>The apply-based approach produces lists, but we need a single table of summary data for input into the dashboard. The <code><a href="../reference/format_result.html">format_result()</a></code> function is included to facilitate this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># pull overall participants from sample data</span>
<span class="kw">data</span>(metrics)
part &lt;-<span class="st"> </span>metrics<span class="op">$</span>participants<span class="op">$</span>tot
<span class="kw">head</span>(part, <span class="dv">3</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   tot    year participants</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 All    2008         5834</span>
<span class="co">#&gt; 2 All    2009         6775</span>
<span class="co">#&gt; 3 All    2010         6820</span>

<span class="kw"><a href="../reference/format_result.html">format_result</a></span>(part, <span class="dt">timeframe =</span> <span class="st">"full-year"</span>, <span class="dt">group =</span> <span class="st">"all_sports"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">3</span>)
<span class="co">#&gt; # A tibble: 3 x 7</span>
<span class="co">#&gt;   timeframe group      segment  year category metric       value</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;int&gt;</span>
<span class="co">#&gt; 1 full-year all_sports All      2008 All      participants  5834</span>
<span class="co">#&gt; 2 full-year all_sports All      2009 All      participants  6775</span>
<span class="co">#&gt; 3 full-year all_sports All      2010 All      participants  6820</span></code></pre></div>
<p>We can use apply to automate this final formatting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">all_part &lt;-<span class="st"> </span>metrics<span class="op">$</span>participants
<span class="kw">lapply</span>(all_part, <span class="cf">function</span>(x) <span class="kw"><a href="../reference/format_result.html">format_result</a></span>(x, <span class="st">"full-year"</span>, <span class="st">"all_sports"</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(segment <span class="op">==</span><span class="st"> "Gender"</span>)
<span class="co">#&gt; # A tibble: 22 x 7</span>
<span class="co">#&gt;    timeframe group      segment  year category metric       value</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;int&gt;</span>
<span class="co">#&gt;  1 full-year all_sports Gender   2008 Male     participants  4725</span>
<span class="co">#&gt;  2 full-year all_sports Gender   2009 Male     participants  5472</span>
<span class="co">#&gt;  3 full-year all_sports Gender   2010 Male     participants  5465</span>
<span class="co">#&gt;  4 full-year all_sports Gender   2011 Male     participants  5456</span>
<span class="co">#&gt;  5 full-year all_sports Gender   2012 Male     participants  5613</span>
<span class="co">#&gt;  6 full-year all_sports Gender   2013 Male     participants  5437</span>
<span class="co">#&gt;  7 full-year all_sports Gender   2014 Male     participants  5786</span>
<span class="co">#&gt;  8 full-year all_sports Gender   2015 Male     participants  5659</span>
<span class="co">#&gt;  9 full-year all_sports Gender   2016 Male     participants  5575</span>
<span class="co">#&gt; 10 full-year all_sports Gender   2017 Male     participants  5513</span>
<span class="co">#&gt; # ... with 12 more rows</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#standardized-license-data">Standardized License Data</a></li>
      <li><a href="#license-history">License History</a></li>
      <li><a href="#dashboard-metrics">Dashboard Metrics</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.southwickassociates.com/our-staff/dan-kary/">Dan Kary</a>, <a href="https://www.southwickassociates.com"><img src="man/figures/logo.jpg" height="30"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
