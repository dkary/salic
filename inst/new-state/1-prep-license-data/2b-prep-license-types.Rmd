---
title: "Prepare License Table to Distinguish Hunters vs Anglers"
date: '`r strftime(Sys.time(), format = "%B %d, %Y")`'
output: 
    html_document:
        toc: true
        toc_float: true
        code_folding: show
---

**Notes**


```{r setup, message=FALSE}
library(tidyverse)
library(salic)
knitr::opts_chunk$set(comment = NA)
```

*Guidelines: A license table preparation step is likely needed to distinguish licenses/permits that confer hunting vs fishing privileges (vs neither). The code below provides a direction, although typically it will involve some by-hand editing in a spreadsheet.*


## Load

*Guidelines: Pull in at least 2 columns: lic_id, description*

```{r}
f <- "../../../../../Data-sensitive/Data-Dashboards/__state__/raw-__period__.sqlite3"
db_raw <- src_sqlite(f)
src_tbls(db_raw)
```

```{r}
lic <- tbl(db_raw, "lic") %>% 
    select(lic_id = LTYPE_ID, year = LTYPE_YEAR, description = LTYPE_DESC) %>%
    collect()
glimpse(lic)
```


## Prep

### Check for dups

*Guidelines: The lic_id should uniquely identify rows. If it doesn't, additional work will be needed. For example Iowa provided a table with a unique row for each year, which was deduped at this step).*

```{r}
length(unique(lic$lic_id))
```


## Export

*Guidelines: Writing to CSV for by-hand editing*

```{r}
dir.create("../data/1-prep-license-data")
write_csv(lic, "../data/1-prep-license-data/license-type.csv")
```

*One of the license table's functions is to distinguish sales (hunting vs fishing). The easiest way to do this is to usually edit the table by hand with a spreadsheet and add a 'type' variable with 4 possible values: fish, hunt, combo (both fishing & hunting), trap (trapping privilege, typically counted in hunting)*

*I recommend adding the type column in excel and then saving as "license-type-prepped.xlsx" with at least 3 variables (lic_id, description, type). This will be imported in the next step (`2c-check-license-types`)*


```{r}
sessionInfo()
```
