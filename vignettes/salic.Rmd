---
title: "Introduction to salic"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7
)
library(dplyr)
library(salic)
```

Package salic lays out a workflow for use in AFWA's national/regional dashboard project. It's intended to simplify/standardize the production of the necessary summary data by providing a set of easy-to-use functions. This vignette illustrates the workflow using sample data (included as part of the salic installation).

Processing data for the dashboard can be divided into 3 parts:

1. **Standardized License Data**: Getting license data into a standard (anonymized) format well-suited for generalized data processing functions.

2. **License History**: Converting into a license history format for easy calculation of dashboard metrics.

3. **Dashboard Metrics**: Applying estimation functions to the license history data, which produces the summaries used as input to the dashboard software.

## 1. Standardized License Data

It's much easier to build a generalized set of tools if we know what the input data looks like. For this reason, salic is pretty strict about how the input license data should be formatted. The process necessary to produce this format will vary by state, but fortunately the data needs for producing dashboards are fairly minimal (and salic provides the `data_check()` function to facilitate this). 

### Customer & License IDs

The fundamental assumption of salic is that customers can be identified across transactions using a customer ID (and similarly, license types can be identified using a license ID). 

![](lic5.png) '

```{r}
# test
data(history, package = "salic")
est_part(history)
```


## Standardizing License Data

These need to be prepared into a standardized format (which is also anonymized to remove any personally-identifiable information).

This process is state-specific since agencies vary in how license data is stored. The standardization is intended to produce a standard format that is well-suited for the generalized presented here. An important part of this step involves anonymizing data by excluding any personally identifiable information from the standard storage format.

### Sample Data

To get started, first load package dependencies:

```r
library(salic)
library(dplyr)
```

Samples of standardized data are provided in salic:

```{r}
data(cust)
glimpse(cust)

data(lic)
glimpse(lic)

data(sale)
glimpse(sale)
```

A function is provided to check that your data fits the specifications (strict for this reason...):

```r
# produces no output (i.e., silent) if no issues detected
check_format(cust, lic, sale)
```

## Building License History

- `rank_sale()` to do this...
    + `join_first_month()` to do that...
    
- `make_lic_history()`
    + `identify_R3()`
    + `identify_lapse()`

Need to also consider the key parameters for this process:

- permission: specifically related to license types include (fish, hunt, combo)
- timeframe: full-year or mid-year
- years

## Calculating Dashboard Metrics

- filter by age
- `label_categories()` & `recode_agecat()`
- `est_part()`, `est_recruit()`, `est_churn()`

### Formatting for final Output

